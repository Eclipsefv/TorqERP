@page "/login"
@layout TorqERP.Components.Layout.LoginLayout
@inject AuthService AuthService
@inject NavigationManager NavManager
@inject ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.Small" Class="d-flex align-center justify-center" Style="height: 100vh;">
    <MudPaper Elevation="4" Class="pa-8" Width="100%">
        <MudText Typo="Typo.h4" Align="Align.Center" GutterBottom="true">TorqERP</MudText>

        <MudTextField @bind-Value="_email" Label="email" Variant="Variant.Outlined" Class="my-4" />
        <MudTextField @bind-Value="_password" Label="Contraseña" Variant="Variant.Outlined"
                      InputType="InputType.Password" />

        <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true"
                   Size="Size.Large" Class="mt-6" OnClick="HandleLogin" Disabled="_isLoading">
            @if (_isLoading)
            {
                <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
            }
            else
            {
                <MudText>Entrar</MudText>
            }
        </MudButton>
    </MudPaper>
</MudContainer>

@code {
    private string _email;
    private string _password;
    private bool _isLoading;

    private async Task HandleLogin()
    {
        _isLoading = true;

        var success = await AuthService.Login(_email, _password);

        if (success)
        {
            NavManager.NavigateTo("/");
        }
        else
        {
            Snackbar.Add("User or password incorrect", Severity.Error);
        }

        _isLoading = false;
    }
}